"use strict";(self.webpackChunkmodio_docs=self.webpackChunkmodio_docs||[]).push([[6149],{9469:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var t=i(4848),r=i(8453);const s={id:"cpp-initialization",title:"Initialization",slug:"/cppsdk/initialization"},a="Initialization",o={id:"game-integration/cppsdk/getting-started/cpp-initialization",title:"Initialization",description:"This guide describes the C++ SDK's basic event loop, initialization, and shutdown functions.",source:"@site/public/en-us/game-integration/cppsdk/getting-started/cpp-initialization.mdx",sourceDirName:"game-integration/cppsdk/getting-started",slug:"/cppsdk/initialization",permalink:"/cppsdk/initialization",draft:!1,unlisted:!1,editUrl:"https://github.com/modio/modio-docs/tree/main/public/en-us/game-integration/cppsdk/getting-started/cpp-initialization.mdx",tags:[],version:"current",frontMatter:{id:"cpp-initialization",title:"Initialization",slug:"/cppsdk/initialization"},sidebar:"sidebar",previous:{title:"Installation",permalink:"/cppsdk/installation"},next:{title:"Windows Setup",permalink:"/cppsdk/windows/getting-started"}},d={},l=[{value:"SDK configuration",id:"sdk-configuration",level:2},{value:"Extended initialization parameters",id:"extended-initialization-parameters",level:2},{value:"General",id:"general",level:3},{value:"Storage Quota",id:"storage-quota",level:3},{value:"Metrics",id:"metrics",level:3},{value:"Event loop (RunPendingHandlers)",id:"event-loop-runpendinghandlers",level:2},{value:"Multithreading",id:"multithreading",level:2},{value:"Using an existing secondary thread",id:"using-an-existing-secondary-thread",level:3},{value:"Using a dedicated background thread",id:"using-a-dedicated-background-thread",level:3},{value:"Shutting down",id:"shutting-down",level:2},{value:"Next steps",id:"next-steps",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"initialization",children:"Initialization"}),"\n",(0,t.jsx)(n.p,{children:"This guide describes the C++ SDK's basic event loop, initialization, and shutdown functions."}),"\n",(0,t.jsx)(n.p,{children:"This guide covers:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#sdk-configuration",children:"SDK configuration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#extended-initialization-parameters",children:"Extended initialization parameters"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#event-loop-runpendinghandlers",children:"Event loop"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#multithreading",children:"Multithreading"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#shutting-down",children:"Shutting down"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#next-steps",children:"Next steps"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"sdk-configuration",children:"SDK configuration"}),"\n",(0,t.jsxs)(n.p,{children:["When you are ready to initialize the SDK for the current session, you'll need to call ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#initializeasync",children:(0,t.jsx)(n.code,{children:"InitializeAsync"})}),", passing in your product's mod.io ID, your API key, the Local Profile Name, and a callback/handler so you know when the SDK is initialized correctly. Note that ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#initializeasync",children:(0,t.jsx)(n.code,{children:"InitializeAsync"})}),"'s callback will be invoked after calling ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:(0,t.jsx)(n.code,{children:"RunPendingHandlers"})})," from your project's main loop."]}),"\n",(0,t.jsx)(n.p,{children:"You should also ensure that you are targeting an appropriate Portal for mod.io to understand what storefront or app the request is originating from. This enabled additional storefront-based functionality, such as returning display name mappings for that portal."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'// represents some external state so we know that the SDK is good to go\nModio::Optional<bool> SDKInitialized;\n\nModio::InitializeOptions Options;\nOptions.APIKey = Modio::ApiKey(YOUR_API_KEY);\nOptions.GameID = Modio::GameID(YOUR_GAME_ID);\nOptions.User = "LocalProfileName";\nOptions.GameEnvironment = Modio::Environment::Live;\nOptions.PortalInUse = Modio::Portal::Steam;\n\nModio::InitializeAsync(Options, [&SDKInitialized](Modio::ErrorCode ec) {\n    if (ec)\n    {\n        // SDK initialization failure\n    }\n    else\n    {\n        // SDK init OK - can now make other calls to the SDK, show mod browser UI, etc\n    }\n});\n'})}),"\n",(0,t.jsxs)(n.p,{children:['It is worth considering that the "LocalProfileName" is used by the mod.io SDK to associate a local session to a user, as mentioned in ',(0,t.jsx)(n.a,{href:"/cppsdk/structure/#users-and-local-profiles",children:"Users and Local Profiles"}),". It is possible to forward a user nickname as the LocalProfileName, then initialize the mod.io SDK. Any data related to a user session will be stored in its corresponding ",(0,t.jsx)(n.a,{href:"/cppsdk/structure/#mod-data-directories",children:"Mod Data Directory"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Notes"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["By convention you'll see these code examples pass in lambda functions as callback handlers, but you can use anything convertible to ",(0,t.jsx)(n.code,{children:"std::function"})," with the appropriate signature."]}),"\n",(0,t.jsxs)(n.li,{children:["The error-handling in this sample is deliberately kept brief. See ",(0,t.jsx)(n.a,{href:"/cppsdk/structure/#error-handling",children:"Error Handling"})," for more information on error handling."]}),"\n",(0,t.jsxs)(n.li,{children:["You can perform calls to other functions, such as something that shows your mod browser UI implementation, directly in the callback. The primary caveat to doing much processing here is that you'll be running in the context of, and therefore blocking, the thread running the callback, which is the thread running ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"extended-initialization-parameters",children:"Extended initialization parameters"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"ExtendedParameters"})," field on ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#InitializeOptions",children:"InitializeOptions"})," is a set of key-value pairs intended for platform-specific or special-case parameters that need to be passed to the SDK.\nSimply set the value before passing your initialization parameters in to ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#initializeasync",children:"InitializeAsync"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'Options.ExtendedParameters["SomeParameterName"] = "SomeParameterValue";\n'})}),"\n",(0,t.jsx)(n.h3,{id:"general",children:"General"}),"\n",(0,t.jsxs)(n.p,{children:["The SDK supports the following general use parameters that can be set through ",(0,t.jsx)(n.code,{children:"ExtendedParameters"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"PendingOnlyResults"})}),(0,t.jsx)(n.td,{children:'Only include UGC in search results that are pending moderation. For moderation and testing purposes. Set to "true" to enable. Warning: Should only be enabled when the user is a moderator or admin of the game, setting in shipping builds is not recommended.'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"PlatformOverride"})}),(0,t.jsx)(n.td,{children:"Set the platform to be used when making requests to show UGC for that platform instead. For moderation and testing purposes. This parameter will soon be deprecated."})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"storage-quota",children:"Storage Quota"}),"\n",(0,t.jsxs)(n.p,{children:["The SDK supports the following storage quota parameters that can be set through ",(0,t.jsx)(n.code,{children:"ExtendedParameters"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ModStorageQuotaMB"})}),(0,t.jsx)(n.td,{children:"Defines a maximum quota of locally installed UGC for this game, in megabytes (minimum 25 MB). This includes temp mods/UGC and those installed by other users on this system."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"CacheStorageQuotaMB"})}),(0,t.jsx)(n.td,{children:"Defines a maximum quota for cached image data such as UGC logos and gallery images, in megabytes (minimum 25 MB)."})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Example usage:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'// Set mod storage quota to 500 MB\nOptions.ExtendedParameters["ModStorageQuotaMB"] = "500";\n\n// Set cache storage quota to 250 MB\nOptions.ExtendedParameters["CacheStorageQuotaMB"] = "250";\n'})}),"\n",(0,t.jsx)(n.p,{children:"By setting these values, the SDK will actively enforce the specified storage limits."}),"\n",(0,t.jsx)(n.h3,{id:"metrics",children:"Metrics"}),"\n",(0,t.jsxs)(n.p,{children:["The SDK supports the following metric parameters that can be set through ",(0,t.jsx)(n.code,{children:"ExtendedParameters"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"MetricsSecretKey"})}),(0,t.jsx)(n.td,{children:"Set the secret key used by the metrics feature."})]})})]}),"\n",(0,t.jsx)(n.h2,{id:"event-loop-runpendinghandlers",children:"Event loop (RunPendingHandlers)"}),"\n",(0,t.jsxs)(n.p,{children:["The SDK's internal event loop requires care and attention in the form of ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["ALL SDK work is performed during executions of ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"}),", therefore calling it as often as possible will improve performance of the SDK's I/O operations."]}),"\n",(0,t.jsxs)(n.p,{children:["You can either call ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," on the main thread, or on a ",(0,t.jsx)(n.a,{href:"#using-a-dedicated-background-thread",children:"dedicated background thread or existing thread of your choice"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["For optimal execution, ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," should be called at least once per frame."]}),"\n",(0,t.jsxs)(n.p,{children:["For example, if you wish to call RunPendingHandlers on the main thread, it could be located into your project's main loop or into a ",(0,t.jsx)(n.code,{children:"tick"}),"-style function on an appropriate controller/manager object."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"while(bGameIsRunning == true)\n{\n    // other stuff\n   Modio::RunPendingHandlers();\n    // other stuff\n}\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["RunPendingHandlers is not reentrant-safe. Do not call ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," inside a callback you give to the SDK, or your application will deadlock. Callbacks are run inside ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"}),", and your inner ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," call will block infinitely waiting for the enclosing scope to exit."]})}),"\n",(0,t.jsx)(n.h2,{id:"multithreading",children:"Multithreading"}),"\n",(0,t.jsxs)(n.p,{children:["The SDK supports ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," being run on a secondary thread that already exists or a dedicated background thread you create specifically to peform SDK work."]}),"\n",(0,t.jsxs)(n.p,{children:["Keep in mind, callbacks you provide to the SDK will run on the thread running ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"}),". If you host ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," on a different thread, it is your responsibility to synchronize with the main thread if you wish to pass results back to it, through callbacks you provide to the SDK."]}),"\n",(0,t.jsx)(n.p,{children:"This allows the SDK to avoid blocking the main thread of your application while performing IO."}),"\n",(0,t.jsx)(n.h3,{id:"using-an-existing-secondary-thread",children:"Using an existing secondary thread"}),"\n",(0,t.jsxs)(n.p,{children:["If you have an existing secondary thread which is not heavily utilized, you can call ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," on that thread:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"while(bRunBackgroundThread == true)\n{\n    // other stuff\n   Modio::RunPendingHandlers();\n    // other stuff\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Just remember, that performance of the SDK is proportional to the amount of CPU cycles you give it, so if you use an existing secondary thread you'll need to ensure that that thread's loop runs at a high enough frequency."}),"\n",(0,t.jsx)(n.h3,{id:"using-a-dedicated-background-thread",children:"Using a dedicated background thread"}),"\n",(0,t.jsxs)(n.p,{children:["Using a dedicated background thread for ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," will ensure the best performance for the SDK's I/O operations by allowing SDK functionality to execute at a rate not limited by your application's main loop frequency or existing background loop frequencies."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"//Assumption: bHaltBackgroundThread is a threadsafe flag or atomic boolean whose lifetime is guaranteed to be longer than that of the handler thread\nHandlerThread = std::thread([&bHaltBackgroundThread]() {\n\twhile (!bHaltBackgroundThread)\n\t{\n\t\tModio::RunPendingHandlers();\n        //Use one of the following if you intend to call ShutdownAsync in your program:\n        std::this_thread::yield();\n        //Change the sleep duration here as appropriate\n        std::this_thread::sleep_for(std::chrono::milliseconds(1));\n\t}\n});\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#shutdownasync",children:"ShutdownAsync"})," takes a lock on the SDK's internal state in order to finalize the pending task queue and shut down internal services."]}),(0,t.jsxs)(n.p,{children:["If you call ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," in a background thread, especially a dedicated background thread, and invoke ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#shutdownasync",children:"ShutdownAsync"})," to close the SDK while your application continues to run, on certain platforms you may find the mutex/lock to be unfair to the point that the main thread cannot take the lock, because the background thread does not get suspended by the OS' scheduler often enough."]}),(0,t.jsxs)(n.p,{children:["If this occurs, we recommend you use either a ",(0,t.jsx)(n.code,{children:"yield"})," or high-resolution ",(0,t.jsx)(n.code,{children:"sleep"})," after each invocation of RunPendingHandlers to allow the main thread to take the shutdown lock. Alternatively, you can use some kind of signaling mechanism to pause the background thread calling RunPendingHandlers, call ShutdownAsync, and then allow that background thread to resume looping."]}),(0,t.jsxs)(n.p,{children:["If the SDK runs for the lifetime of your application and you do not call ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#shutdownasync",children:"ShutdownAsync"})," this is not necessary."]})]}),"\n",(0,t.jsx)(n.h2,{id:"shutting-down",children:"Shutting down"}),"\n",(0,t.jsx)(n.p,{children:"To finalize and shut down the mod.io SDK is equally simple:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// State variable, stored in some valid scope\nbool SDKShutdownComplete = false;\n\n// Capture reference to the state variable in the lambda - could use shared_ptr for more safety instead\nModio::ShutdownAsync([&SDKShutdownComplete](Modio::ErrorCode ec)\n{\n    SDKShutdownComplete = true;\n});\n\nwhile(!SDKShutdownComplete)\n{\n    Modio::RunPendingHandlers();\n}\n\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#shutdownasync",children:"ShutdownAsync"})," uses a lock to ensure that global SDK state is not mutated out from underneath an invocation of ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"}),". It is not safe to call ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#shutdownasync",children:"ShutdownAsync"})," in any callback you provide to the SDK. Callbacks are executed during ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," execution, your application will deadlock while waiting for the enclosing ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," to complete. The lock is deliberately not implemented to support recursive locking, again because ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#shutdownasync",children:"ShutdownAsync"})," mutates data structures that ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," expects to remain unchanged for the duration of its scope."]})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["You will need to continue to call ",(0,t.jsx)(n.a,{href:"/cppsdk/refdocs/#runpendinghandlers",children:"RunPendingHandlers"})," while the async shutdown is in progress to allow for intermediate handlers to finish running."]})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,t.jsxs)(n.p,{children:["Now that you are all set up, you may want to learn more about the ",(0,t.jsx)(n.a,{href:"/cppsdk/structure/",children:"SDK Structure"})," to get a better understanding of the C++ SDK and its processes."]}),"\n",(0,t.jsxs)(n.p,{children:["Or if you are eager to get things moving, you can skip directly to setting up ",(0,t.jsx)(n.a,{href:"/cppsdk/user-authentication",children:"User Authentication"})," or ",(0,t.jsx)(n.a,{href:"/cppsdk/searching-ugc",children:"Searching for UGC"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["All the core setup information you need can be found in the ",(0,t.jsx)(n.a,{href:"/cppsdk/#c-sdk-core-setup-guides",children:"C++ SDK Getting Started Guides"}),", which are designed to teach you how to implement mod.io's fundamentals."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(6540);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);